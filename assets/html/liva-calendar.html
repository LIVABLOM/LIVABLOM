<div id="liva-calendar-container" class="calendar-wrapper liva-calendar-wrapper"></div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const container = document.getElementById("liva-calendar-container");

    fetch("/assets/calendars/liva_calendar.json")
        .then(response => response.json())
        .then(bookedRanges => {
            const today = new Date();
            let currentMonth = today.getMonth();
            let currentYear = today.getFullYear();

            function generateCalendar(month, year) {
                container.innerHTML = "";

                const calendar = document.createElement("div");
                calendar.classList.add("calendar");

                const monthNames = ["Janvier", "Février", "Mars", "Avril", "Mai", "Juin", "Juillet", "Août", "Septembre", "Octobre", "Novembre", "Décembre"];
                const days = ["Lun", "Mar", "Mer", "Jeu", "Ven", "Sam", "Dim"];

                const header = document.createElement("div");
                header.classList.add("calendar-header");
                header.innerHTML = `
                    <button class="prev-month">◀</button>
                    <span>${monthNames[month]} ${year}</span>
                    <button class="next-month">▶</button>
                `;
                calendar.appendChild(header);

                const grid = document.createElement("div");
                grid.classList.add("calendar-grid");

                days.forEach(day => {
                    const cell = document.createElement("div");
                    cell.classList.add("calendar-day-name");
                    cell.textContent = day;
                    grid.appendChild(cell);
                });

                const firstDay = new Date(year, month, 1).getDay();
                const skipDays = firstDay === 0 ? 6 : firstDay - 1;
                for (let i = 0; i < skipDays; i++) {
                    const emptyCell = document.createElement("div");
                    emptyCell.classList.add("empty");
                    grid.appendChild(emptyCell);
                }

                const daysInMonth = new Date(year, month + 1, 0).getDate();

                for (let day = 1; day <= daysInMonth; day++) {
                    const cellDate = new Date(year, month, day);
                    const cell = document.createElement("div");
                    cell.classList.add("calendar-day");
                    cell.textContent = day;

                    const booked = bookedRanges.some(range => {
                        const start = new Date(range.start);
                        const end   = new Date(range.end);
                        return cellDate >= start && cellDate < end; 
                        // ⭐ PAREIL QUE BLOM → le jour de départ reste réservable
                    });

                    if (booked) {
                        cell.classList.add("booked");
                    } else {
                        cell.classList.add("available");
                        cell.addEventListener("click", () => selectDate(cellDate));
                    }

                    grid.appendChild(cell);
                }

                calendar.appendChild(grid);
                container.appendChild(calendar);

                document.querySelector(".prev-month").onclick = () => {
                    currentMonth--;
                    if (currentMonth < 0) {
                        currentMonth = 11;
                        currentYear--;
                    }
                    generateCalendar(currentMonth, currentYear);
                };

                document.querySelector(".next-month").onclick = () => {
                    currentMonth++;
                    if (currentMonth > 11) {
                        currentMonth = 0;
                        currentYear++;
                    }
                    generateCalendar(currentMonth, currentYear);
                };
            }

            generateCalendar(currentMonth, currentYear);
        });

    function selectDate(date) {
        const input = document.querySelector("#date");
        if (input) input.value = date.toISOString().split("T")[0];
    }
});
</script>

<style>
.calendar-wrapper {
    width: 100%;
    max-width: 420px;
    margin: auto;
}
.calendar {
    background: #111;
    padding: 15px;
    border-radius: 10px;
    color: white;
}
.calendar-header {
    display: flex;
    justify-content: space-between;
    font-size: 1.2rem;
    align-items: center;
}
.calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 5px;
    margin-top: 10px;
}
.calendar-day,
.calendar-day-name {
    text-align: center;
    padding: 10px;
    border-radius: 5px;
}

.booked {
    background: red;
    opacity: 0.4;
    color: white;
}

.available {
    background: #222;
    cursor: pointer;
}
.available:hover {
    background: #444;
}
</style>
